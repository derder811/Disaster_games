[gd_scene load_steps=4 format=3 uid="uid://bgll4a52be7j0"]

[ext_resource type="Texture2D" uid="uid://cpnkhjjc55psl" path="res://asset/button/Settings Menu/Resume Button.png" id="1_qkudd"]
[ext_resource type="Texture2D" uid="uid://c2ekm2x5qerr1" path="res://asset/button/Settings Menu/Menu Button.png" id="2_pdkhq"]

[sub_resource type="GDScript" id="GDScript_gg1fk"]
script/source = "extends Control

# Variables
var is_paused = false
var original_scales = {}

# UI References
@onready var resume_button = $Background/PopupPanel/MenuContainer/ResumeButton
@onready var settings_button = $Background/PopupPanel/MenuContainer/SettingsButton

func _ready():
	# Wait for the scene to be fully loaded
	await get_tree().process_frame
	
	# Check if buttons exist before accessing their properties
	if resume_button and settings_button:
		# Store original button scales
		original_scales[\"ResumeButton\"] = resume_button.scale
		original_scales[\"SettingsButton\"] = settings_button.scale
		
		# Connect button signals
		resume_button.pressed.connect(_on_resume_button_pressed)
		settings_button.pressed.connect(_on_settings_button_pressed)
		
		# Connect hover animations
		resume_button.mouse_entered.connect(_on_button_hover.bind(\"ResumeButton\"))
		resume_button.mouse_exited.connect(_on_button_unhover.bind(\"ResumeButton\"))
		settings_button.mouse_entered.connect(_on_button_hover.bind(\"SettingsButton\"))
		settings_button.mouse_exited.connect(_on_button_unhover.bind(\"SettingsButton\"))
	else:
		print(\"Error: Could not find pause menu buttons!\")
	
	# Initially hide the pause menu
	visible = false

func _input(event):
	if event.is_action_pressed(\"pause_game\") or (event is InputEventKey and event.keycode == KEY_ESCAPE):
		if is_paused:
			resume_game()
		else:
			pause_game()

func pause_game():
	is_paused = true
	get_tree().paused = true
	visible = true
	_fade_in_menu()

func resume_game():
	is_paused = false
	get_tree().paused = false
	_fade_out_menu()

func _fade_in_menu():
	modulate.a = 0.0
	var fade_tween = create_tween()
	fade_tween.tween_property(self, \"modulate:a\", 1.0, 0.3)

func _fade_out_menu():
	var fade_tween = create_tween()
	fade_tween.tween_property(self, \"modulate:a\", 0.0, 0.3)
	await fade_tween.finished
	visible = false

func _on_button_hover(button_name: String):
	var button = get_node(\"Background/PopupPanel/MenuContainer/\" + button_name)
	if button and original_scales.has(button_name):
		var hover_tween = create_tween()
		hover_tween.tween_property(button, \"scale\", original_scales[button_name] * 1.1, 0.2)

func _on_button_unhover(button_name: String):
	var button = get_node(\"Background/PopupPanel/MenuContainer/\" + button_name)
	if button and original_scales.has(button_name):
		var unhover_tween = create_tween()
		unhover_tween.tween_property(button, \"scale\", original_scales[button_name], 0.2)

func _animate_button_click(button_name: String, callback: Callable):
	var button = get_node(\"Background/PopupPanel/MenuContainer/\" + button_name)
	
	if button and original_scales.has(button_name):
		# Click animation: scale down then up
		var click_tween = create_tween()
		click_tween.tween_property(button, \"scale\", original_scales[button_name] * 0.9, 0.1)
		click_tween.tween_property(button, \"scale\", original_scales[button_name] * 1.05, 0.1)
		click_tween.tween_property(button, \"scale\", original_scales[button_name], 0.1)
		
		# Wait for animation to complete then execute callback
		await click_tween.finished
		callback.call()
	else:
		# If button is null or scale not found, just execute callback
		callback.call()

func _on_resume_button_pressed():
	_animate_button_click(\"ResumeButton\", func(): resume_game())

func _on_settings_button_pressed():
	_animate_button_click(\"SettingsButton\", func(): _open_settings())

func _open_settings():
	# Hide the pause menu before showing settings
	_fade_out_menu()
	# Get the GameSettings node from the main scene
	var game_settings = get_node(\"../GameSettings\")
	if game_settings:
		game_settings.show_settings()
	else:
		print(\"GameSettings node not found!\")
"

[node name="PauseMenu" type="Control"]
process_mode = 2
visible = false
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = SubResource("GDScript_gg1fk")

[node name="Background" type="ColorRect" parent="."]
visible = false
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 0.5)

[node name="PopupPanel" type="PopupPanel" parent="Background"]
size = Vector2i(1008, 723)

[node name="MenuContainer" type="VBoxContainer" parent="Background/PopupPanel"]
visible = false
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 4.0
offset_top = 4.0
offset_right = 1004.0
offset_bottom = 719.0
grow_horizontal = 2
grow_vertical = 2

[node name="PauseLabel" type="Label" parent="Background/PopupPanel/MenuContainer"]
visible = false
layout_mode = 2
size_flags_horizontal = 4
theme_override_font_sizes/font_size = 32
text = "PAUSED"
horizontal_alignment = 1

[node name="Spacer1" type="Control" parent="Background/PopupPanel/MenuContainer"]
visible = false
layout_mode = 2
size_flags_vertical = 3

[node name="ResumeButton" type="TextureButton" parent="Background/PopupPanel/MenuContainer"]
visible = false
layout_mode = 2
size_flags_horizontal = 4
texture_normal = ExtResource("1_qkudd")

[node name="Spacer2" type="Control" parent="Background/PopupPanel/MenuContainer"]
visible = false
layout_mode = 2
size_flags_vertical = 3

[node name="SettingsButton" type="TextureButton" parent="Background/PopupPanel/MenuContainer"]
visible = false
layout_mode = 2
size_flags_horizontal = 4
texture_normal = ExtResource("2_pdkhq")

[node name="Spacer3" type="Control" parent="Background/PopupPanel/MenuContainer"]
visible = false
layout_mode = 2
size_flags_vertical = 3
